```
!pip install pyspark==3.0.1 py4j==0.10.9 
```

    Collecting pyspark==3.0.1
    [?25l  Downloading https://files.pythonhosted.org/packages/f0/26/198fc8c0b98580f617cb03cb298c6056587b8f0447e20fa40c5b634ced77/pyspark-3.0.1.tar.gz (204.2MB)
    [K     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 204.2MB 74kB/s 
    [?25hCollecting py4j==0.10.9
    [?25l  Downloading https://files.pythonhosted.org/packages/9e/b6/6a4fb90cd235dc8e265a6a2067f2a2c99f0d91787f06aca4bcf7c23f3f80/py4j-0.10.9-py2.py3-none-any.whl (198kB)
    [K     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 204kB 43.5MB/s 
    [?25hBuilding wheels for collected packages: pyspark
      Building wheel for pyspark (setup.py) ... [?25l[?25hdone
      Created wheel for pyspark: filename=pyspark-3.0.1-py2.py3-none-any.whl size=204612242 sha256=1b6f59ac73ccb41c423edd2caa2c1a27e670959524fb2065f486bc012af6f1ad
      Stored in directory: /root/.cache/pip/wheels/5e/bd/07/031766ca628adec8435bb40f0bd83bb676ce65ff4007f8e73f
    Successfully built pyspark
    Installing collected packages: py4j, pyspark
    Successfully installed py4j-0.10.9 pyspark-3.0.1



```
from pyspark.sql import SparkSession

spark = SparkSession \
    .builder \
    .appName("Python Spark Dataframe basic example") \
    .getOrCreate()
```


```
import pandas as pd

apple_pandas_df = pd.read_csv("https://pyspark-test-sj.s3-us-west-2.amazonaws.com/appl_stock.csv")
```

### DateÏó¥Ïùò typeÏùÑ stringÏóêÏÑú dateÎ°ú Î≥ÄÍ≤Ω


```
apple_pandas_df['Date'] = pd.to_datetime(apple_pandas_df['Date'], format='%Y-%m-%d') 
apple_spark_df = spark.createDataFrame(apple_pandas_df)
```


```
apple_spark_df.createOrReplaceTempView("applestock")
```

### Ïñ¥Îñ§ Ïª¨Îüº Ïù¥Î¶ÑÎì§Ïù¥ ÏûàÎäîÍ∞Ä?


```
spark.sql("SHOW COLUMNS FROM applestock").show()
```

    +---------+
    | col_name|
    +---------+
    |     Date|
    |     Open|
    |     High|
    |      Low|
    |    Close|
    |   Volume|
    |Adj Close|
    +---------+
    


### Ïä§ÌÇ§ÎßàÎ•º ÌîÑÎ¶∞Ìä∏Ìï¥Î≥¥Í∏∞


```
spark.sql("DESCRIBE applestock").show()
```

    +---------+---------+-------+
    | col_name|data_type|comment|
    +---------+---------+-------+
    |     Date|timestamp|   null|
    |     Open|   double|   null|
    |     High|   double|   null|
    |      Low|   double|   null|
    |    Close|   double|   null|
    |   Volume|   bigint|   null|
    |Adj Close|   double|   null|
    +---------+---------+-------+
    


### Ï≤òÏùå 5Í∞úÏùò Î†àÏΩîÎìúÎ•º Ï∂úÎ†•Ìï¥Î≥¥Í∏∞


```
spark.sql("SELECT * FROM applestock LIMIT 5").show()
```

    +-------------------+----------+----------+----------+----------+---------+------------------+
    |               Date|      Open|      High|       Low|     Close|   Volume|         Adj Close|
    +-------------------+----------+----------+----------+----------+---------+------------------+
    |2010-01-04 00:00:00|213.429998|214.499996|212.380001|214.009998|123432400|         27.727039|
    |2010-01-05 00:00:00|214.599998|215.589994|213.249994|214.379993|150476200|         27.774976|
    |2010-01-06 00:00:00|214.379993|    215.23|210.750004|210.969995|138040000|27.333178000000004|
    |2010-01-07 00:00:00|    211.75|212.000006|209.050005|    210.58|119282800|          27.28265|
    |2010-01-08 00:00:00|210.299994|212.000006|209.060005|211.980005|111902700|         27.464034|
    +-------------------+----------+----------+----------+----------+---------+------------------+
    


### Close Ïª¨ÎüºÏùò ÌèâÍ∑†Í∞íÏùÄ ÏñºÎßàÏù∏Í∞Ä




```
spark.sql("SELECT AVG(Close) FROM applestock").show()
```

    +-----------------+
    |       avg(Close)|
    +-----------------+
    |312.9270656379114|
    +-----------------+
    


### Volume Ïª¨ÎüºÏùò ÏµúÎåÄÍ∞íÍ≥º ÏµúÏÜåÍ∞íÏùÄ?


```
spark.sql("SELECT MAX(Volume), MIN(Volume) From applestock").show()
```

    +-----------+-----------+
    |max(Volume)|min(Volume)|
    +-----------+-----------+
    |  470249500|   11475900|
    +-----------+-----------+
    


#### Î≥¥ÎÑàÏä§ ÏßàÎ¨∏: HV ratioÎùºÎäî Ïù¥Î¶ÑÏùò ÏÉàÎ°úÏö¥ Ïª¨ÎüºÏùÑ Ï∂îÍ∞ÄÌïú Îç∞Ïù¥ÌÑ∞ÌîÑÎ†àÏûÑÏùÑ ÎßåÎì§Í∏∞. Ïù¥ Ïª¨ÎüºÏùò Í∞íÏùÄ High/VolumeÏúºÎ°ú Í≥ÑÏÇ∞ÎêúÎã§


```
hv = spark.sql("SELECT *, High / Volume AS Hv From applestock").show()
```

    +-------------------+----------+------------------+----------+----------+---------+------------------+--------------------+
    |               Date|      Open|              High|       Low|     Close|   Volume|         Adj Close|                  Hv|
    +-------------------+----------+------------------+----------+----------+---------+------------------+--------------------+
    |2010-01-04 00:00:00|213.429998|        214.499996|212.380001|214.009998|123432400|         27.727039|1.737793286041590...|
    |2010-01-05 00:00:00|214.599998|        215.589994|213.249994|214.379993|150476200|         27.774976|1.432718223878593...|
    |2010-01-06 00:00:00|214.379993|            215.23|210.750004|210.969995|138040000|27.333178000000004|1.559185743262822...|
    |2010-01-07 00:00:00|    211.75|        212.000006|209.050005|    210.58|119282800|          27.28265|1.777288980473295...|
    |2010-01-08 00:00:00|210.299994|        212.000006|209.060005|211.980005|111902700|         27.464034|1.894503045949740...|
    |2010-01-11 00:00:00|212.799997|        213.000002|208.450005|210.110003|115557400|         27.221758|1.843239827133528...|
    |2010-01-12 00:00:00|209.189995|        209.769995|206.419998|207.720001|148614900|          26.91211|1.411500428288146E-6|
    |2010-01-13 00:00:00|207.870005|        210.929995|204.099998|210.650002|151473000|          27.29172|1.392525367557254...|
    |2010-01-14 00:00:00|210.110003|        210.459997|209.020004|    209.43|108223500|         27.133657|1.944679270213955E-6|
    |2010-01-15 00:00:00|210.929995|211.59999700000003|205.869999|    205.93|148516900|         26.680198|1.424753661031169E-6|
    |2010-01-19 00:00:00|208.330002|215.18999900000003|207.240004|215.039995|182501900|         27.860485|1.179111006515548...|
    |2010-01-20 00:00:00|214.910006|        215.549994|209.500002|    211.73|153038200|         27.431644|1.408471832522860...|
    |2010-01-21 00:00:00|212.079994|        213.309996|207.210003|208.069996|152038600|         26.957455|1.402998948951121...|
    |2010-01-22 00:00:00|206.780006|        207.499996|    197.16|    197.75|220441900|         25.620401|9.412910884908904E-7|
    |2010-01-25 00:00:00|202.510002|        204.699999|200.190002|203.070002|266424900|         26.309658|7.683215757986584E-7|
    |2010-01-26 00:00:00|205.950001|        213.710005|202.580004|205.940001|466777500|         26.681494|4.578412734118504E-7|
    |2010-01-27 00:00:00|206.849995|            210.58|199.530001|207.880005|430642100|          26.93284|4.889907419641508E-7|
    |2010-01-28 00:00:00|204.930004|        205.500004|198.699995|199.289995|293375600|         25.819922|7.004672644896166E-7|
    |2010-01-29 00:00:00|201.079996|        202.199995|190.250002|192.060003|311488100|         24.883208|6.491419575900331E-7|
    |2010-02-01 00:00:00|192.369997|             196.0|191.299999|194.729998|187469100|         25.229131|1.045505632661596E-6|
    +-------------------+----------+------------------+----------+----------+---------+------------------+--------------------+
    only showing top 20 rows
    


#### Î≥¥ÎÑàÏä§ ÏßàÎ¨∏: ÏõîÎ≥Ñ Close Ïª¨ÎüºÏùò ÌèâÍ∑†Í∞íÏùÄ?


```
spark.sql("SELECT Month(Date) AS Month, AVG(Close) from applestock GROUP BY Month(Date)").show()
```

    +-----+------------------+
    |Month|        avg(Close)|
    +-----+------------------+
    |   12|302.35053626845644|
    |    1| 322.2097142571429|
    |    6|288.12546566000003|
    |    3| 332.9115673137254|
    |    5|  351.621020857143|
    |    9| 301.0763195902777|
    |    4| 340.5104108150685|
    |    8|300.43858096129026|
    |    7| 281.7221621148649|
    |   10|308.30552563157903|
    |   11| 306.2725174895105|
    |    2| 321.3595563037037|
    +-----+------------------+
    



```

```
